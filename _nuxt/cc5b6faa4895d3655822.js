(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{368:function(e,t,n){var content=n(375);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(24).default)("7dcaab94",content,!0,{sourceMap:!1})},369:function(e,t,n){var content=n(377);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(24).default)("261aa8c8",content,!0,{sourceMap:!1})},370:function(e,t,n){var content=n(379);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(24).default)("95587ad4",content,!0,{sourceMap:!1})},371:function(e,t,n){var content=n(381);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(24).default)("4bdb01a6",content,!0,{sourceMap:!1})},372:function(e,t,n){"use strict";var r=n(39),o=n(9),c=n(40),l=n(200),h=n(201),d=n(31),m=n(373),f=n(202);o(o.S+o.F*!n(203)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,o,_,v=c(e),x="function"==typeof this?this:Array,S=arguments.length,y=S>1?arguments[1]:void 0,w=void 0!==y,k=0,M=f(v);if(w&&(y=r(y,S>2?arguments[2]:void 0,2)),null==M||x==Array&&h(M))for(n=new x(t=d(v.length));t>k;k++)m(n,k,w?y(v[k],k):v[k]);else for(_=M.call(v),n=new x;!(o=_.next()).done;k++)m(n,k,w?l(_,y,[o.value,k],!0):o.value);return n.length=k,n}})},373:function(e,t,n){"use strict";var r=n(15),o=n(64);e.exports=function(object,e,t){e in object?r.f(object,e,o(0,t)):object[e]=t}},374:function(e,t,n){"use strict";var r=n(368);n.n(r).a},375:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,".search-input{text-align:center}.search-input__speech-toggle{cursor:pointer;text-align:center;display:inline-block;margin:0 auto;border:none;background:none;padding:20px;color:#dcdfe6;outline:none}.search-input__speech-toggle .el-input__icon{transition-duration:.1s}.search-input__speech-toggle:hover{color:#666}.search-input__speech-toggle.active{color:#409eff}",""])},376:function(e,t,n){"use strict";var r=n(369);n.n(r).a},377:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,".card-item{display:flex;padding:10px;color:#666}.card-item:hover{color:#999}.card-item-text{padding:inherit;color:inherit}",""])},378:function(e,t,n){"use strict";var r=n(370);n.n(r).a},379:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,".card-items-list{background:#fff}.card-items-header{font-weight:700;padding:5px}.message{margin-top:15px;margin-bottom:15px;box-shadow:none!important;border:none;border-radius:0;text-align:left;float:left;transition:none;overflow:visible}.message:hover .el-card__header{opacity:1}.message .el-card__header{opacity:0;padding:2px 10px;border:none}.message .el-card__header .el-button:hover{background:none;color:#999}.message .el-card__body{padding:0}.message__text{padding:5px 10px;border-radius:20px;display:inline-block}.message__text-wrap{border-left:3px solid #fff;margin-left:-3px}.message_my{float:right}.message_my .message__text{float:right;background:#ffe478;border-bottom-right-radius:0}.message_answer .message__text{background:#f0f2f5;border-top-left-radius:0}.message_info .message__text-wrap{border-left-color:rgba(23,163,184,.33725)}.message_success .message__text-wrap{border-left-color:#28a745}.message_warning .message__text-wrap{border-left-color:#ffc107}.message_error .message__text-wrap{border-left-color:#dc3545}.message__date{margin-left:10px;font-size:.8rem}.message__resend{margin-left:10px;background:none;border:none;padding:0}.message__buttons{margin-top:3px;margin-left:6px}",""])},380:function(e,t,n){"use strict";var r=n(371);n.n(r).a},381:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,".dialog{width:100%;text-align:center}.dialog__messages{overflow-y:scroll;padding:0 1rem;height:calc(100vh - 172px)}.dialog__messages:hover{padding-right:.5rem}.dialog__messages:hover::-webkit-scrollbar{width:1rem}.dialog__messages::-webkit-scrollbar{width:.5rem}.dialog__messages::-webkit-scrollbar-track{background-color:#eee}.dialog__messages::-webkit-scrollbar-thumb{background-color:#a9a9a9;outline:1px solid #708090}",""])},382:function(e,t,n){"use strict";n.r(t);n(94),n(143),n(372),n(50);var r=n(5);n(92).a.register({microphone:{width:352,height:512,paths:[{d:"M176 352c-53 0-96-43-96-96v-160c0-53 43-96 96-96s96 43 96 96v160c0 53-43 96-96 96zM336 192c8.8 0 16 7.2 16 16v48c0 88.9-66.3 162.5-152 174.2v33.8h56c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16h-160c-8.8 0-16-7.2-16-16v-16c0-8.8 7.2-16 16-16h56v-34.2c-88-12.1-152-92-152-181.7v-40.2c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v42.3c0 66.8 48.7 126.6 115.2 133.1 76.3 7.4 140.8-52.6 140.8-127.4v-48c0-8.8 7.2-16 16-16h16z"}]}});var o=n(18),c={props:{value:{default:""}},data:function(){return{lang:"ru-RU",q:this.value,recognition:!1,isSpeechRunning:!1,isSpeechWillStart:!1,runtimeTranscription:"",transcription:[],volume:0,audioContext:!1,lastInput:""}},computed:{volumeScale:function(){var e=this.volume;return this.volume<.01&&(e=0),Math.min(1.5,1+10*e)},speechEngine:function(){return this.$store.state.speechEngine},yandexAPIKey:function(){return this.$store.state.yandexAPIKey},messages:function(){return this.$store.state.messages}},watch:{value:function(e){this.q=e},q:function(e){this.$emit("input",e)},messages:function(e){this.onMessagesChange(e)}},methods:{submit:function(){this.$emit("submit",this.q),this.q=""},onMessagesChange:function(e){this.isSpeechWillStart&&("Робот"==e[e.length-1].author&&(this.isSpeechWillStart=!1,this.speechStart()))},speechStart:function(){({browser:this.speechStartBrowser,yandex:this.speechStartYandex})[this.speechEngine]()},speechStartYandex:function(){var e=this;this.isSpeechRunning||this.recognition&&(this.isSpeechRunning=!0,navigator.getUserMedia({video:!1,audio:!0},this.onGetUserMedia,function(e){console.log("Ошибка доступа к микрофону, возможно, вы запретили его использование.",e)}),ya.speechkit.recognize({apikey:this.yandexAPIKey,utteranceSilence:60,doneCallback:this.onSpeechEndYandex,initCallback:function(){this.isSpeechRunning=!0},errorCallback:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.speechStop();case 2:console.log("Возникла ошибка при запросе к yandex: "+n);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}))},speechStartBrowser:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recognition){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.speechStop();case 4:this.recognition.start(),this.isSpeechRunning=!0,navigator.getUserMedia({video:!1,audio:!0},this.onGetUserMedia,function(e){console.log("Ошибка доступа к микрофону, возможно, вы запретили его использование.",e)});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),speechStop:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={browser:this.speechStopBrowser,yandex:this.speechStopYandex},e.next=3,t[this.speechEngine]();case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),speechStopYandex:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioContext){e.next=8;break}return e.prev=1,e.next=4,this.audioContext.close();case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:this.volume=0,this.isSpeechRunning=!1;case 10:case"end":return e.stop()}},e,this,[[1,6]])}));return function(){return e.apply(this,arguments)}}(),speechStopBrowser:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recognition&&this.recognition.stop(),!this.audioContext){e.next=9;break}return e.prev=2,e.next=5,this.audioContext.close();case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:this.volume=0,this.isSpeechRunning=!1;case 11:case"end":return e.stop()}},e,this,[[2,7]])}));return function(){return e.apply(this,arguments)}}(),speechToggle:function(){return this.isSpeechRunning?this.speechStop():this.speechStart()},onSpeechEndYandex:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(text){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isSpeechRunning){e.next=2;break}return e.abrupt("return");case 2:if(""!==text){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.speechStop();case 6:this.isSpeechWillStart=!0,this.q=text,this.lastInput=this.q,this.submit();case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),onSpeechEndBrowser:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.speechStop();case 2:if(this.runtimeTranscription){e.next=4;break}return e.abrupt("return");case 4:if(this.runtimeTranscription!=this.lastInput){e.next=6;break}return e.abrupt("return");case 6:this.transcription.push(this.runtimeTranscription),this.q=this.runtimeTranscription,this.lastInput=this.q,this.submit(),this.speechStart();case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),initSpeechApi:function(){console.log("Init speech API: ",this.speechEngine),{browser:this.speechInitBrowser,yandex:this.speechInitYandex}[this.speechEngine]()},speechInitYandex:function(){this.recognition=!0},speechInitBrowser:function(){var e=this;if(window.SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition,SpeechRecognition){this.recognition=new SpeechRecognition;var t=this.recognition;this.speechStop(),t.lang=this.lang,t.interimResults=!1,t.addEventListener("result",function(t){var text=Array.from(t.results).map(function(e){return e[0]}).map(function(e){return e.transcript}).join("");e.runtimeTranscription=text}),t.addEventListener("end",this.onSpeechEndBrowser),this.recognition=t}},onGetUserMedia:function(e){this.audioContext=new AudioContext;var source=this.audioContext.createMediaStreamSource(e),meter=this.createAudioMeter(this.audioContext);source.connect(meter)},createAudioMeter:function(e,t,n,r){var o=e.createScriptProcessor(512);return o.onaudioprocess=this.volumeAudioProcess,o.clipping=!1,o.lastClip=0,o.volume=0,o.clipLevel=t||.98,o.averaging=n||.95,o.clipLag=r||750,o.connect(e.destination),o.checkClipping=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},o.shutdown=function(){this.disconnect(),this.onaudioprocess=null},o},volumeAudioProcess:function(e){for(var t,n=e.target,r=e.inputBuffer.getChannelData(0),o=r.length,c=0,i=0;i<o;i++)t=r[i],Math.abs(t)>=n.clipLevel&&(n.clipping=!0,n.lastClip=window.performance.now()),c+=t*t;var l=Math.sqrt(c/o);this.volume=l},clearMessages:function(){this.$store.commit(o.SET_MESSAGES,[])}},mounted:function(){this.initSpeechApi()},destroyed:function(){this.speechStop()}},l=(n(374),n(13)),h=Object(l.a)(c,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"search-input"},[n("button",{class:{"speech-toggle":!0,"search-input__speech-toggle":!0,active:e.isSpeechRunning},attrs:{slot:"suffix"},on:{click:e.speechToggle},slot:"suffix"},[e.recognition?n("icon",{staticClass:"el-icon-speech el-input__icon",style:{transform:"scale("+e.volumeScale+")"},attrs:{name:"microphone"}}):e._e()],1),e._v(" "),n("el-input",{ref:"input",attrs:{clearable:"",autofocus:""},nativeOn:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"c",void 0,t.key,void 0)?null:t.ctrlKey?void(e.q=""):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"l",void 0,t.key,void 0)?null:t.ctrlKey?(t.preventDefault(),e.clearMessages(t)):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:e.$emit("up")}],keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.$emit("down")}},model:{value:e.q,callback:function(t){e.q=t},expression:"q"}})],1)},[],!1,null,null,null).exports,d=(n(95),n(144)),m={props:["title","image","url","payload","hide"],computed:{text:function(){return this.title||this.value},sendText:function(){return this.value||this.title},cardItemIconStyle:function(){return{"background-image":"url(https://avatars.mds.yandex.net/get-dialogs-skill-card/"+this.image+"/menu-list-x1",width:"60px",height:"60px",overflow:"hidden",position:"relative","background-size":"cover","background-repeat":"no-repeat","background-position":"0 0"}}},methods:{onClick:function(){this.url?window.open(this.url,"_blank"):(this.$store.commit(o.ADD_MESSAGE,{text:this.sendText,author:o.AUTHOR_NAME}),this.$store.dispatch(o.ALICE_REQUEST,{command:this.sendText,type:"ButtonPressed",payload:this.payload,url:this.url,hide:this.hide}))}}},f=(n(376),Object(l.a)(m,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"card-item",on:{click:this.onClick}},[t("div",{style:this.cardItemIconStyle}),this._v(" "),t("div",{staticClass:"card-item-text",attrs:{title:this.title},domProps:{innerHTML:this._s(this.text)}})])},[],!1,null,null,null).exports),_={components:{MessageButton:d.a,CardItem:f},props:["message"],computed:{isMy:function(){return this.message.author==o.AUTHOR_NAME},text:function(){return this.message.text?this.message.text.split("\n").join("<br>"):""}},methods:{resend:function(){this.$store.commit(o.ADD_MESSAGE,{text:this.message.text,author:o.AUTHOR_NAME}),this.$store.dispatch(o.ALICE_REQUEST,this.message.text)}}},v=(n(378),{components:{SearchInput:h,Message:Object(l.a)(_,function(){var e,t=this,n=t.$createElement,r=t._self._c||n;return r("el-card",{class:(e={message:!0,message_my:t.isMy},e["message_"+t.message.class]=t.message.class,e)},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t._v("\n    "+t._s(t.message.author)+" "),r("span",{staticClass:"message__date"},[t._v(t._s(t.message.date))]),t._v(" "),t.isMy?r("el-button",{staticClass:"message__resend",attrs:{title:"resend",icon:"el-icon-refresh"},on:{click:t.resend}}):t._e()],1),t._v(" "),r("div",{staticClass:"message__text-wrap"},[r("div",{staticClass:"message__text"},[r("span",{domProps:{innerHTML:t._s(t.text)}}),t._v(" "),t.message.card&&t.message.card.items&&t.message.card.items.length>0?r("div",{staticClass:"card-items-list"},[t.message.card.header?r("span",{staticClass:"card-items-header",domProps:{innerHTML:t._s(t.message.card.header.text)}}):t._e(),t._v(" "),t._l(t.message.card.items,function(e){return r("CardItem",{key:e.image_id,attrs:{image:e.image_id,title:e.title,payload:e.button.payload}})})],2):t._e()])]),t._v(" "),r("div",{staticClass:"message__buttons"},t._l(t.message.buttons,function(button){return r("MessageButton",{key:button.title,staticClass:"message__button",attrs:{title:button.title,value:button.value,url:button.url,payload:button.payload}})}),1)])},[],!1,null,null,null).exports,MessageButton:d.a},data:function(){return{currentMessage:-1,q:""}},computed:{messages:function(){return this.$store.state.messages},tests:function(){return this.$store.state.tests}},watch:{messages:function(){this.$refs.searchInput.$refs.input.focus()}},methods:{onSubmit:function(e){this.currentMessage=-1,this.$store.commit(o.ADD_MESSAGE,{text:e,author:o.AUTHOR_NAME});var t=e.match(/^use (.*)$/);t?this.$store.dispatch(o.SET_WEBHOOK_URL,t[1]):this.$store.dispatch(o.ALICE_REQUEST,e)},previousMessage:function(){this.currentMessage++;var e=this.getMyMessage(this.currentMessage);if(e){if(this.q==e.text)return void this.previousMessage()}else this.currentMessage--,e=this.getMyMessage(this.currentMessage);this.q=e.text},nextMessage:function(){if(-1!=this.currentMessage)if(this.currentMessage--,-1!=this.currentMessage){var e=this.getMyMessage(this.currentMessage);this.q!=e.text?this.q=e.text:this.nextMessage()}else this.q=""},getMyMessage:function(e){var t=this.messages.filter(function(e){return e.author==o.AUTHOR_NAME});return t[t.length-1-e]||!1},getUserId:function(){var e=localStorage.getItem("userId");return e||(e=this.$store.getters.randomGuid,localStorage.setItem("userId",e)),e},getWebhookURLs:function(){try{return JSON.parse(localStorage.getItem("webhookURLs"))}catch(e){return[]}}},mounted:function(){var e=this;this.$store.commit(o.SET_USER_ID,this.getUserId()),this.$store.dispatch(o.SESSION_START),this.$store.commit(o.SET_WEBHOOK_URLS,this.getWebhookURLs()),this.$route.query.use?this.$store.dispatch(o.SET_WEBHOOK_URL,this.$route.query.use):this.$store.dispatch(o.SET_WEBHOOK_URL,localStorage.getItem("webhookURL")),this.$route.query.msg&&setTimeout(function(){e.$store.commit(o.ADD_MESSAGE,{text:e.$route.query.msg,author:o.AUTHOR_NAME}),e.$store.dispatch(o.ALICE_REQUEST,e.$route.query.msg)},1500)},created:function(){this.messages.length>this.$store.state.settings.messageStoreLimit&&this.$store.commit(o.SET_MESSAGES,this.messages.slice(this.messages.length-this.$store.state.settings.messageStoreLimit))},updated:function(){this.$nextTick(function(){this.$refs.messages&&(this.$refs.messages.scrollTop=this.$refs.messages.scrollHeight)})}}),x=(n(380),{components:{Dialog:Object(l.a)(v,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dialog"},[e.messages?n("div",{ref:"messages",staticClass:"messages dialog__messages"},[n("el-row",e._l(e.messages,function(e){return n("el-row",{key:e.id,staticClass:"messages__message"},[n("Message",{attrs:{message:e}})],1)}),1),e._v(" "),e.tests.length>0&&e.$store.state.settings.isBottomTests?n("div",{staticClass:"dialog__tests"},[e._l(e.tests,function(dialog){return n("MessageButton",{key:dialog.name,class:{message__button:!0,"message-button_success":!0===dialog.success,"message-button_error":!1===dialog.success},attrs:{title:dialog.name,payload:JSON.stringify({scenarios_test:[dialog]})}})}),e._v(" "),n("MessageButton",{staticClass:"message__button",attrs:{title:"все тесты",payload:JSON.stringify({scenarios_test:e.tests})}})],2):e._e()],1):e._e(),e._v(" "),n("SearchInput",{ref:"searchInput",on:{submit:e.onSubmit,up:e.previousMessage,down:e.nextMessage},model:{value:e.q,callback:function(t){e.q=t},expression:"q"}})],1)},[],!1,null,null,null).exports}}),S=Object(l.a)(x,function(){var e=this.$createElement;return(this._self._c||e)("Dialog")},[],!1,null,null,null);t.default=S.exports}}]);